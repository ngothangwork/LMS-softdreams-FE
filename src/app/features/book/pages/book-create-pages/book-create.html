<div class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Thêm Sách</h2>

    <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label>Tên</label>
        <input formControlName="name" type="text" />
        <div class="error" *ngIf="bookForm.get('name')?.touched && bookForm.get('name')?.invalid">
          <div *ngIf="bookForm.get('name')?.errors?.['required']">Tên sách là bắt buộc</div>
          <div *ngIf="bookForm.get('name')?.errors?.['minlength']">Tên phải có ít nhất 3 ký tự</div>
        </div>
      </div>


      <div class="form-group">
        <label>Ảnh bìa</label>
        <input type="file" (change)="onFileSelected($event)" />
        <img *ngIf="bookForm.get('avatar')?.value"
             [src]="bookForm.get('avatar')?.value"
             alt="preview" class="preview"/>
      </div>

      <div class="form-group">
        <label>ISBN</label>
        <input formControlName="isbn" type="text" />
        <div class="error" *ngIf="bookForm.get('isbn')?.touched && bookForm.get('isbn')?.invalid">
          <div *ngIf="bookForm.get('isbn')?.errors?.['required']">ISBN là bắt buộc</div>
          <div *ngIf="bookForm.get('isbn')?.errors?.['pattern']">ISBN chỉ được chứa số và dấu -</div>
        </div>
      </div>


      <div class="form-group">
        <label>Nhà xuất bản</label>
        <select formControlName="publisherId">
          <option *ngFor="let p of publishers" [value]="p.id">{{ p.name }}</option>
        </select>
        <div class="error" *ngIf="bookForm.get('publisherId')?.touched && bookForm.get('publisherId')?.invalid">
          <div>Vui lòng chọn nhà xuất bản</div>
        </div>
      </div>


      <div class="form-group">
        <label>Tác giả</label>
        <ng-multiselect-dropdown
          [data]="authors"
          formControlName="authorIds"
          [settings]="authorDropdownSettings"
          placeholder="Chọn tác giả">
        </ng-multiselect-dropdown>
        <div class="error" *ngIf="bookForm.get('authorIds')?.touched && bookForm.get('authorIds')?.invalid">
          <div>Vui lòng chọn ít nhất một tác giả</div>
        </div>
      </div>

      <div class="form-group">
        <label>Thể loại</label>
        <ng-multiselect-dropdown
          [data]="categories"
          formControlName="categoryIds"
          [settings]="categoryDropdownSettings"
          placeholder="Chọn thể loại">
        </ng-multiselect-dropdown>
        <div class="error" *ngIf="bookForm.get('categoryIds')?.touched && bookForm.get('categoryIds')?.invalid">
          <small>Vui lòng chọn ít nhất một thể loại</small>
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="btn btn-primary" [disabled]="bookForm.invalid">Thêm</button>
        <button type="button" class="btn btn-secondary" (click)="onClose()">Đóng</button>
      </div>
    </form>
  </div>
</div>
